---
- set_fact: thisIp="{{hostvars[inventory_hostname]['ansible_' + iface]['ipv4']['address']}}"

- name: install kafka-connect-elasticsearch-docker image
  docker:
    name:     kafka-connect-elasticsearch-docker
    image:    vimond-docker-dockerv2-local.artifactoryonline.com/kafka-connect-elasticsearch-docker:{{ version }}
    registry: https://vimond-docker-dockerv2-local.artifactoryonline.com
    pull:           "{{ docker_pull | d('always') }}"
    state:          reloaded
    restart_policy: always
    expose:
      - 8160
      - 9010
    ports:
      - 8160:8160
    env:
      KAFKA_CONNECT_MODE: distributed
      ZOOKEEPER_ADDRESS: zk-0.service.consul
      KAFKA_ADDRESS: kafka-08.service.consul
      ELASTICSEARCH_ADDRESS: elasticsearch.service.consul
      CONFIG_STORAGE_TOPIC: kafka-connect-config
      OFFSET_STORAGE_TOPIC: kafka-connect-offset
      THIS_IP: "{{ thisIp }}"
      KAFKA_NAMESPACE: /kafka0.8
      ELASTICSEARCH_INDEX: vimond-numbers
      ELASTICSEARCH_TYPES: user-asset_playback-event,order-event,user-operations-event
  tags:
    - kafka_kafka-connect-elasticsearch-docker
