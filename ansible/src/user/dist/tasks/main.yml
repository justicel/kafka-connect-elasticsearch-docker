---
- name: install kafka-connect-elasticsearch-docker image
  docker:
    name:     kafka-connect-elasticsearch-docker
    image:    vimond-docker-dockerv2-local.artifactoryonline.com/kafka-connect-elasticsearch-docker:{{ version }}
    registry: https://vimond-docker-dockerv2-local.artifactoryonline.com
    pull:           "{{ docker_pull | d('always') }}"
    state:          reloaded
    restart_policy: always
    publish_all_ports: "true"
    env:
      KAFKA_CONNECT_MODE: distributed
      ZOOKEEPER_ADDRESS: zk-0.service.consul
      KAFKA_ADDRESS: kafka-08.service.consul
      ELASTICSEARCH: elasticsearch.service.consul
  tags:
    - kafka_kafka-connect-elasticsearch-docker


# these are to populate values in consul key-value store, used for service discovery and port defaults.
- name: populate kafka-connect-elasticsearch-docker service values in consul
  run_once: true
  uri: url=http://localhost:8500/v1/kv/haproxy_services/kafka-connect-elasticsearch-docker/{{ item.key }} body={{ item.value }} method=PUT
  with_items:
    - key: service_port
      value: 8160
    - key: context
      value: /vkc
  tags:
    - kafka_kafka-connect-elasticsearch-docker

